package com.thingtrack.konekti.view.module.integration.addon;

import java.io.UnsupportedEncodingException;

import com.thingtrack.konekti.view.addon.ui.WindowDialog;
import com.thingtrack.konekti.view.module.integration.internal.Protocol;
import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Property.ConversionException;
import com.vaadin.data.Property.ReadOnlyException;
import com.vaadin.ui.AbsoluteLayout;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.PopupDateField;
import com.vaadin.ui.TextArea;
import com.vaadin.ui.TextField;

@SuppressWarnings("serial")
public class ProtocolViewForm extends CustomComponent {

	@AutoGenerated
	private AbsoluteLayout mainLayout;
	@AutoGenerated
	private TextArea payloadField;
	@AutoGenerated
	private PopupDateField protocolDateField;
	@AutoGenerated
	private TextField fileNameField;
	@AutoGenerated
	private TextField protocolTypeField;
	
	private Protocol protocol;
	
	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

	/**
	 * The constructor should first build the main layout, set the composition
	 * root and then do any custom initialization.
	 * 
	 * The constructor will not be automatically regenerated by the visual
	 * editor.
	 */
	public ProtocolViewForm() {
		buildMainLayout();
		setCompositionRoot(mainLayout);

		// TODO add user code here
		initComponents();
	}
	
	private void initComponents() {
		fileNameField.setNullRepresentation("");
		protocolTypeField.setNullRepresentation("");
		protocolDateField.setDateFormat("dd/MM/YYYY HH:mm:ss");
	}
	
	@Override
    public void attach() {
		super.attach();
		
		// recover the parent entity (Client) from parent view window (ClientViewForm)
		if (getParent().getWindow() instanceof WindowDialog<?>) {
			@SuppressWarnings("unchecked")
			WindowDialog<Protocol> protocolWindowDialog = (WindowDialog<Protocol>)getParent().getWindow();
			protocol = protocolWindowDialog.getDomainEntity();
			
			try {
				payloadField.setValue(new String(protocol.getFileArray(), "UTF-8"));
			} catch (ReadOnlyException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (ConversionException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (UnsupportedEncodingException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
	}	
	
	@AutoGenerated
	private AbsoluteLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new AbsoluteLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("560px");
		mainLayout.setHeight("300px");
		mainLayout.setMargin(true);
		
		// top-level component properties
		setWidth("560px");
		setHeight("300px");
		
		// protocolTypeField
		protocolTypeField = new TextField();
		protocolTypeField.setCaption("Tipo Procolo");
		protocolTypeField.setImmediate(false);
		protocolTypeField.setWidth("340px");
		protocolTypeField.setHeight("24px");
		protocolTypeField.setTabIndex(1);
		mainLayout.addComponent(protocolTypeField, "top:56.0px;left:20.0px;");
		
		// fileNameField
		fileNameField = new TextField();
		fileNameField.setCaption("Nombre Fichero");
		fileNameField.setImmediate(false);
		fileNameField.setWidth("340px");
		fileNameField.setHeight("-1px");
		mainLayout.addComponent(fileNameField, "top:17.0px;left:20.0px;");
		
		// protocolDateField
		protocolDateField = new PopupDateField();
		protocolDateField.setCaption("Fecha Protocolo");
		protocolDateField.setImmediate(false);
		protocolDateField.setWidth("160px");
		protocolDateField.setHeight("-1px");
		mainLayout.addComponent(protocolDateField, "top:20.0px;left:380.0px;");
		
		// payloadField
		payloadField = new TextArea();
		payloadField.setCaption("Carga Protocolo");
		payloadField.setImmediate(false);
		payloadField.setWidth("520px");
		payloadField.setHeight("180px");
		mainLayout.addComponent(payloadField, "top:100.0px;left:20.0px;");
		
		return mainLayout;
	}
}
